<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profil Utilisateur</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          min-height:100vh; display:flex; justify-content:center; align-items:center; padding:20px; position:relative;
        }

        /* Boutons fixes en haut */
        .buttons-container {
          position: fixed; top:20px; right:20px;
          display:flex; gap:10px; z-index:100;
        }
        .buttons-container button {
          background:#fff; color:#667eea; border:none; padding:8px 16px; border-radius:10px;
          font-size:0.95rem; font-weight:600; cursor:pointer; box-shadow:0 4px 10px rgba(0,0,0,0.2); transition:all 0.2s;
        }
        .buttons-container button:hover { background:#667eea; color:#fff; }

        .profile-container {
          background:white; border-radius:24px; box-shadow:0 20px 60px rgba(0,0,0,0.3);
          overflow:hidden; width:100%; max-width:550px;
        }
        .header {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          padding:40px 30px; text-align:center; color:white;
          position: relative;
        }
        .profile-photo { width:120px; height:120px; border-radius:50%; border:4px solid white; margin-bottom:15px; object-fit:cover; }
        h1 { font-size:2rem; font-weight:700; margin-bottom:5px; }
        .profile-content { padding:30px; }
        .info-group { margin-bottom:20px; padding-bottom:20px; border-bottom:1px solid #e5e7eb; }
        .info-group:last-child { border-bottom:none; }
        .info-label { font-size:0.85rem; color:#9ca3af; font-weight:600; margin-bottom:5px; }
        .info-value { font-size:1.1rem; color:#374151; font-weight:500; }
        .loading { text-align:center; padding:40px; color:#667eea; }
        .error { text-align:center; padding:40px; color:#dc2626; }

        /* Bouton discuter */
        .chat-button {
          background: linear-gradient(135deg, #10b981 0%, #059669 100%);
          color: white;
          border: none;
          padding: 12px 24px;
          border-radius: 25px;
          font-size: 1rem;
          font-weight: 600;
          cursor: pointer;
          box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
          transition: all 0.3s ease;
          display: flex;
          align-items: center;
          gap: 8px;
          margin: 20px auto;
          width: fit-content;
        }
        .chat-button:hover {
          transform: translateY(-2px);
          box-shadow: 0 6px 20px rgba(16, 185, 129, 0.6);
        }
        .chat-button:active {
          transform: translateY(0);
        }

        /* Bouton modifier mon profil */
        .edit-profile-button {
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          color: white;
          border: none;
          padding: 12px 24px;
          border-radius: 25px;
          font-size: 1rem;
          font-weight: 600;
          cursor: pointer;
          box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
          transition: all 0.3s ease;
          display: flex;
          align-items: center;
          gap: 8px;
          margin: 20px auto;
          width: fit-content;
        }
        .edit-profile-button:hover {
          transform: translateY(-2px);
          box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        .edit-profile-button:active {
          transform: translateY(0);
        }

        /* Styles pour les favoris musicaux */
        .favoris-section {
          background:#f8f9ff;
          border:2px solid #e0e7ff;
          border-radius:12px;
          padding:20px;
          margin:20px 0;
        }
        .section-title {
          font-weight:700;
          color:#667eea;
          margin-bottom:15px;
          text-align:center;
          font-size:1.1rem;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 10px;
        }
        .favoris-item {
          display:flex;
          justify-content:space-between;
          align-items:center;
          padding:12px 0;
          border-bottom:1px solid #e5e7eb;
        }
        .favoris-item:last-child {
          border-bottom:none;
        }
        .favoris-genre {
          font-weight:600;
          color:#374151;
          font-size:1rem;
        }
        .favoris-cote {
          font-size:0.9rem;
          padding:6px 12px;
          border-radius:8px;
          font-weight:600;
          min-width: 60px;
          text-align: center;
        }
        .cote-10 { background:#dbeafe; color:#2563eb; border: 2px solid #2563eb; }
        .cote-9 { background:#dbeafe; color:#2563eb; }
        .cote-8 { background:#d1fae5; color:#059669; }
        .cote-7 { background:#d1fae5; color:#059669; }
        .cote-6 { background:#fef3c7; color:#d97706; }
        .cote-5 { background:#fef3c7; color:#d97706; }
        .cote-4 { background:#fef3c7; color:#d97706; }
        .cote-3 { background:#fee2e2; color:#dc2626; }
        .cote-2 { background:#fee2e2; color:#dc2626; }
        .cote-1 { background:#fee2e2; color:#dc2626; border: 2px solid #dc2626; }

        /* ==================================== */
        /* STYLE POUR LES R√âSEAUX SOCIAUX - NOUVEAU DESIGN */
        /* ==================================== */
        .reseaux-section {
          background: rgba(20, 20, 30, 0.7);
          border-radius: 20px;
          padding: 25px;
          margin: 25px 0;
          border: 1px solid rgba(100, 126, 234, 0.3);
          backdrop-filter: blur(10px);
          box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }

        .reseaux-title {
          color: #FFFFFF;
          font-size: 1.8rem;
          margin-bottom: 30px;
          letter-spacing: 8px;
          text-transform: uppercase;
          text-align: center;
          font-weight: 300;
          text-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
        }

        .icons-grid {
          display: grid;
          grid-template-columns: repeat(2, 1fr);
          gap: 40px;
          justify-items: center;
          align-items: center;
          width: 100%;
          padding: 10px;
        }

        /* Style pour les r√©seaux avec LOGOS PLEINS (Instagram, Facebook, TikTok, Snapchat) - BULLES AGRANDIES */
        .reseau-icon-wrapper {
          width: 100%;
          max-width: 140px; /* AGRANDI */
          aspect-ratio: 1 / 1;
          border-radius: 50%;
          overflow: hidden;
          cursor: pointer;
          transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
          background: rgba(255, 255, 255, 0.05);
          border: 2px solid rgba(255, 255, 255, 0.1);
          box-shadow: 0 4px 20px rgba(0, 0, 0, 0.6);
          position: relative;
        }

        /* LES LOGOS PRENNENT TOUTE LA BULLE */
        .reseau-icon-wrapper img {
          width: 100%;
          height: 100%;
          object-fit: cover; /* MODIFI√â: couvre toute la bulle */
          display: block;
          transition: all 0.3s ease;
        }

        /* Style pour les NOUVEAUX R√âSEAUX avec EFFET VERRE - BULLES AGRANDIES */
        .reseau-icon-custom {
          width: 100%;
          max-width: 140px; /* AGRANDI */
          aspect-ratio: 1 / 1;
          border-radius: 50%;
          overflow: hidden;
          cursor: pointer;
          transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
          background: rgba(255, 255, 255, 0.1);
          border: 2px solid rgba(255, 255, 255, 0.2);
          box-shadow: 0 4px 20px rgba(0, 0, 0, 0.6);
          backdrop-filter: blur(8px);
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          text-decoration: none;
          color: white; /* Couleur par d√©faut */
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* STYLE AM√âLIOR√â POUR LE TEXTE DANS LES BULLES CUSTOM */
        .reseau-icon-custom .reseau-name {
          font-size: 0.75rem; /* L√©g√®rement plus grand */
          font-weight: 800; /* Plus gras */
          letter-spacing: 1px; /* Plus d'espacement */
          text-transform: uppercase;
          margin-top: 8px;
          text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
          transition: color 0.3s ease;
        }

        .reseau-icon-custom .reseau-symbol {
          font-size: 2.5rem; /* Plus grand */
          margin-bottom: 5px;
          filter: drop-shadow(0 3px 6px rgba(0, 0, 0, 0.4));
          transition: all 0.3s ease;
        }

        /* Effets de survol pour TOUS les r√©seaux */
        .reseau-icon-wrapper:hover,
        .reseau-icon-custom:hover {
          transform: scale(1.25);
          box-shadow: 0 0 40px rgba(255, 255, 255, 0.4), 0 15px 40px rgba(0, 0, 0, 0.9);
          border-color: rgba(255, 255, 255, 0.3);
        }

        .reseau-icon-wrapper:hover img {
          transform: scale(1.05);
        }

        /* Couleurs de survol pour les r√©seaux avec LOGOS PLEINS */
        .reseau-icon-wrapper[data-network="instagram"]:hover {
          border-color: #E4405F;
          box-shadow: 0 0 50px #E4405F, 0 0 70px rgba(228, 64, 95, 0.6);
        }

        .reseau-icon-wrapper[data-network="facebook"]:hover {
          border-color: #1877F2;
          box-shadow: 0 0 50px #1877F2, 0 0 70px rgba(24, 119, 242, 0.6);
        }

        .reseau-icon-wrapper[data-network="tiktok"]:hover {
          border-color: #00F2EA;
          box-shadow: 0 0 50px #00F2EA, 0 0 70px rgba(0, 242, 234, 0.6);
        }

        .reseau-icon-wrapper[data-network="snapchat"]:hover {
          border-color: #FFFC00;
          box-shadow: 0 0 50px #FFFC00, 0 0 70px rgba(255, 252, 0, 0.6);
        }

        /* STYLE SP√âCIAL POUR LES R√âSEAUX CUSTOM AU SURVOL */
        /* Le texte prend la couleur de survol */
        .reseau-icon-custom[data-network="youtube"]:hover {
          border-color: #FF0000;
          box-shadow: 0 0 50px #FF0000, 0 0 70px rgba(255, 0, 0, 0.6);
        }
        .reseau-icon-custom[data-network="youtube"]:hover .reseau-name,
        .reseau-icon-custom[data-network="youtube"]:hover .reseau-symbol {
          color: #FF0000 !important;
          text-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
        }

        .reseau-icon-custom[data-network="whatsapp"]:hover {
          border-color: #25D366;
          box-shadow: 0 0 50px #25D366, 0 0 70px rgba(37, 211, 102, 0.6);
        }
        .reseau-icon-custom[data-network="whatsapp"]:hover .reseau-name,
        .reseau-icon-custom[data-network="whatsapp"]:hover .reseau-symbol {
          color: #25D366 !important;
          text-shadow: 0 0 10px rgba(37, 211, 102, 0.5);
        }

        .reseau-icon-custom[data-network="twitter"]:hover {
          border-color: #000000;
          box-shadow: 0 0 50px #000000, 0 0 70px rgba(0, 0, 0, 0.6);
        }
        .reseau-icon-custom[data-network="twitter"]:hover .reseau-name,
        .reseau-icon-custom[data-network="twitter"]:hover .reseau-symbol {
          color: #000000 !important;
          text-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .reseau-icon-custom[data-network="linkedin"]:hover {
          border-color: #0077B5;
          box-shadow: 0 0 50px #0077B5, 0 0 70px rgba(0, 119, 181, 0.6);
        }
        .reseau-icon-custom[data-network="linkedin"]:hover .reseau-name,
        .reseau-icon-custom[data-network="linkedin"]:hover .reseau-symbol {
          color: #0077B5 !important;
          text-shadow: 0 0 10px rgba(0, 119, 181, 0.5);
        }

        .reseau-icon-custom[data-network="pinterest"]:hover {
          border-color: #E60023;
          box-shadow: 0 0 50px #E60023, 0 0 70px rgba(230, 0, 35, 0.6);
        }
        .reseau-icon-custom[data-network="pinterest"]:hover .reseau-name,
        .reseau-icon-custom[data-network="pinterest"]:hover .reseau-symbol {
          color: #E60023 !important;
          text-shadow: 0 0 10px rgba(230, 0, 35, 0.5);
        }

        .reseau-icon-custom[data-network="telegram"]:hover {
          border-color: #0088CC;
          box-shadow: 0 0 50px #0088CC, 0 0 70px rgba(0, 136, 204, 0.6);
        }
        .reseau-icon-custom[data-network="telegram"]:hover .reseau-name,
        .reseau-icon-custom[data-network="telegram"]:hover .reseau-symbol {
          color: #0088CC !important;
          text-shadow: 0 0 10px rgba(0, 136, 204, 0.5);
        }

        .reseau-icon-custom[data-network="mixcloud"]:hover {
          border-color: #52AAD8;
          box-shadow: 0 0 50px #52AAD8, 0 0 70px rgba(82, 170, 216, 0.6);
        }
        .reseau-icon-custom[data-network="mixcloud"]:hover .reseau-name,
        .reseau-icon-custom[data-network="mixcloud"]:hover .reseau-symbol {
          color: #52AAD8 !important;
          text-shadow: 0 0 10px rgba(82, 170, 216, 0.5);
        }

        .reseau-icon-custom[data-network="soundcloud"]:hover {
          border-color: #FF5500;
          box-shadow: 0 0 50px #FF5500, 0 0 70px rgba(255, 85, 0, 0.6);
        }
        .reseau-icon-custom[data-network="soundcloud"]:hover .reseau-name,
        .reseau-icon-custom[data-network="soundcloud"]:hover .reseau-symbol {
          color: #FF5500 !important;
          text-shadow: 0 0 10px rgba(255, 85, 0, 0.5);
        }

        .reseau-icon-wrapper[data-network="default"]:hover,
        .reseau-icon-custom[data-network="default"]:hover {
          border-color: #667eea;
          box-shadow: 0 0 50px #667eea, 0 0 70px rgba(102, 126, 234, 0.6);
        }
        .reseau-icon-custom[data-network="default"]:hover .reseau-name,
        .reseau-icon-custom[data-network="default"]:hover .reseau-symbol {
          color: #667eea !important;
          text-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
        }

        .no-content {
          color:#6b7280;
          font-style:italic;
          text-align:center;
          padding:15px;
        }

        /* Indicateur de son en cours */
        .son-playing-indicator {
          position: fixed;
          top: 20px;
          left: 20px;
          background: rgba(16, 185, 129, 0.9);
          color: white;
          padding: 8px 16px;
          border-radius: 20px;
          font-size: 0.9rem;
          font-weight: 600;
          z-index: 1000;
          display: none;
          align-items: center;
          gap: 8px;
          animation: pulse 2s infinite;
        }

        @keyframes pulse {
          0% { transform: scale(1); }
          50% { transform: scale(1.05); }
          100% { transform: scale(1); }
        }

        /* Responsive */
        @media (max-width: 768px) {
          .buttons-container {
            top: 10px;
            right: 10px;
            flex-direction: column;
            gap: 5px;
          }
          .buttons-container button {
            padding: 6px 12px;
            font-size: 0.85rem;
          }
          .profile-container {
            margin-top: 60px;
            max-width: 95%;
          }
          .reseaux-title {
            font-size: 1.5rem;
            letter-spacing: 6px;
          }
          .icons-grid {
            gap: 30px;
          }
          .reseau-icon-wrapper,
          .reseau-icon-custom {
            max-width: 130px; /* Ajust√© pour mobile */
          }
        }

        @media (max-width: 480px) {
          .reseaux-title {
            font-size: 1.3rem;
            letter-spacing: 4px;
            margin-bottom: 25px;
          }
          .icons-grid {
            gap: 25px;
          }
          .reseau-icon-wrapper,
          .reseau-icon-custom {
            max-width: 115px; /* Ajust√© pour mobile */
          }
          .reseau-icon-custom .reseau-name {
            font-size: 0.7rem;
          }
          .reseau-icon-custom .reseau-symbol {
            font-size: 2.2rem;
          }
        }

        @media (max-width: 360px) {
          .icons-grid {
            gap: 20px;
          }
          .reseau-icon-wrapper,
          .reseau-icon-custom {
            max-width: 105px; /* Ajust√© pour mobile */
          }
        }
    </style>
</head>
<body>

<!-- Indicateur de son en cours -->
<div id="sonPlayingIndicator" class="son-playing-indicator">
    üîà Son d'entr√©e en cours...
</div>

<div class="buttons-container">
    <button onclick="window.location.href='/menu/menu.html'">‚¨Ö Retour</button>
    <button id="btnLogout">üö™ D√©connexion</button>
</div>

<div class="profile-container">
    <div class="header">
        <img id="profilePhoto" class="profile-photo" src="" alt="Photo de profil">
        <h1 id="profileUsername">Chargement...</h1>
    </div>

    <div class="profile-content" id="profileContent">
        <div class="loading">Chargement des informations...</div>
    </div>
</div>

<!-- Lecteur audio cach√© -->
<audio id="sonEntreePlayer" class="audio-player"></audio>

<script>
    const token = localStorage.getItem('accessToken');

    // V√©rifier si l'utilisateur est connect√©
    if (!token) {
        alert('Vous devez √™tre connect√© pour voir les profils');
        window.location.href = '/connection/connection.html';
    }

    // Variables pour stocker les donn√©es
    let currentUserId = null;
    let targetUserId = null;
    let currentUserData = null;

    // R√©cup√©rer l'ID depuis les param√®tres d'URL
    function getUserIdFromURL() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('userId');
    }

    // R√©cup√©rer l'utilisateur courant
    async function getCurrentUser() {
        try {
            const response = await fetch('/api/users/me', {
                headers: { 'Authorization': 'Bearer ' + token }
            });
            if (!response.ok) throw new Error('Erreur lors de la r√©cup√©ration du profil');
            return await response.json();
        } catch (error) {
            console.error('Erreur:', error);
            return null;
        }
    }

    // Fonction pour charger les favoris musicaux
    async function loadMusicFavoris(userId) {
        try {
            const response = await fetch(`/api/users/${userId}/music-favoris`, {
                headers: { 'Authorization': 'Bearer ' + token }
            });

            if (response.ok) {
                const data = await response.json();
                return data.favoris || data;
            } else {
                return [];
            }
        } catch (err) {
            console.error('Erreur chargement favoris:', err);
            return [];
        }
    }

    // Fonction pour nettoyer l'URL des sauts de ligne
    function cleanUrl(url) {
        if (!url) return '';
        return url.replace(/\n/g, '').replace(/\r/g, '').trim();
    }

    // Fonction pour jouer le son d'entr√©e
    function playSonEntree(sonUrl) {
        if (!sonUrl) return;

        const cleanedUrl = cleanUrl(sonUrl);
        const audioPlayer = document.getElementById('sonEntreePlayer');
        const indicator = document.getElementById('sonPlayingIndicator');

        audioPlayer.src = cleanedUrl;
        audioPlayer.volume = 0.7;

        indicator.style.display = 'flex';

        audioPlayer.onplay = function() {
            console.log('üéµ Son d\'entr√©e en cours de lecture');
        };

        audioPlayer.onended = function() {
            indicator.style.display = 'none';
            console.log('üéµ Son d\'entr√©e termin√©');
        };

        audioPlayer.onerror = function() {
            indicator.style.display = 'none';
            console.error('‚ùå Erreur lors de la lecture du son');
        };

        audioPlayer.play().catch(error => {
            console.error('Erreur de lecture audio:', error);
            indicator.style.display = 'none';
        });
    }

    // Fonction pour cr√©er l'ic√¥ne d'un r√©seau custom avec effet verre
    function createCustomReseauIcon(url, network) {
        const cleanedUrl = cleanUrl(url);

        let symbol = '';
        let networkName = '';

        switch(network) {
            case 'youtube':
                symbol = '‚ñ∂';
                networkName = 'YouTube';
                break;
            case 'whatsapp':
                symbol = 'üì±';
                networkName = 'WhatsApp';
                break;
            case 'twitter':
                symbol = 'ùïè';
                networkName = 'X';
                break;
            case 'linkedin':
                symbol = 'in';
                networkName = 'LinkedIn';
                break;
            case 'pinterest':
                symbol = 'P';
                networkName = 'Pinterest';
                break;
            case 'telegram':
                symbol = '‚úà';
                networkName = 'Telegram';
                break;
            case 'mixcloud':
                symbol = '‚òÅ';
                networkName = 'Mixcloud';
                break;
            case 'soundcloud':
                symbol = '‚ô´';
                networkName = 'SoundCloud';
                break;
            default:
                symbol = 'üåê';
                networkName = 'Site Web';
        }

        return `
            <a href="${cleanedUrl}" target="_blank" class="reseau-icon-custom" data-network="${network}" title="Visiter ${networkName}">
                <div class="reseau-symbol">${symbol}</div>
                <div class="reseau-name">${networkName}</div>
            </a>
        `;
    }

    // Fonction pour cr√©er l'ic√¥ne d'un r√©seau avec logo plein
    function createLogoReseauIcon(url, network, logoUrl) {
        const cleanedUrl = cleanUrl(url);

        return `
            <a href="${cleanedUrl}" target="_blank" class="reseau-icon-wrapper" data-network="${network}" title="Visiter ${network}">
                <img src="${logoUrl}" alt="Logo ${network}" onerror="this.src='https://raw.githubusercontent.com/djhustla/music-storage/main/logos_reseaux/default.png'">
            </a>
        `;
    }

    // Fonction pour obtenir les infos du r√©seau (nouveau syst√®me)
    function getReseauInfo(url) {
        url = url.toLowerCase();

        // R√©seaux avec LOGOS PLEINS (on ne change pas ces r√©seaux)
        if (url.includes('instagram.com')) {
            return {
                type: 'logo',
                network: 'instagram',
                logo: 'https://raw.githubusercontent.com/djhustla/music-storage/main/logos_reseaux/instagram.png'
            };
        }
        if (url.includes('facebook.com')) {
            return {
                type: 'logo',
                network: 'facebook',
                logo: 'https://raw.githubusercontent.com/djhustla/music-storage/main/logos_reseaux/facebook.png'
            };
        }
        if (url.includes('tiktok.com')) {
            return {
                type: 'logo',
                network: 'tiktok',
                logo: 'https://raw.githubusercontent.com/djhustla/music-storage/main/logos_reseaux/tiktok.png'
            };
        }
        if (url.includes('snapchat.com')) {
            return {
                type: 'logo',
                network: 'snapchat',
                logo: 'https://raw.githubusercontent.com/djhustla/music-storage/main/logos_reseaux/snap.png'
            };
        }

        // NOUVEAUX R√âSEAUX avec EFFET VERRE
        if (url.includes('youtube.com') || url.includes('youtu.be')) {
            return {
                type: 'custom',
                network: 'youtube'
            };
        }
        if (url.includes('whatsapp.com')) {
            return {
                type: 'custom',
                network: 'whatsapp'
            };
        }
        if (url.includes('twitter.com') || url.includes('x.com')) {
            return {
                type: 'custom',
                network: 'twitter'
            };
        }
        if (url.includes('linkedin.com')) {
            return {
                type: 'custom',
                network: 'linkedin'
            };
        }
        if (url.includes('pinterest.com')) {
            return {
                type: 'custom',
                network: 'pinterest'
            };
        }
        if (url.includes('t.me') || url.includes('telegram.me')) {
            return {
                type: 'custom',
                network: 'telegram'
            };
        }
        if (url.includes('mixcloud.com')) {
            return {
                type: 'custom',
                network: 'mixcloud'
            };
        }
        if (url.includes('soundcloud.com')) {
            return {
                type: 'custom',
                network: 'soundcloud'
            };
        }

        // Pour tous les autres r√©seaux non sp√©cifi√©s
        return {
            type: 'custom',
            network: 'default'
        };
    }

    // Fonction pour afficher les favoris musicaux
    function displayMusicFavoris(favoris) {
        if (!favoris || favoris.length === 0) {
            return `
                <div class="favoris-section">
                    <div class="section-title">üéµ Favoris Musicaux</div>
                    <div class="no-content">Aucun favori musical d√©fini</div>
                </div>
            `;
        }

        const sortedFavoris = [...favoris].sort((a, b) => b.cotePreference - a.cotePreference);

        let html = `
            <div class="favoris-section">
                <div class="section-title">üéµ Favoris Musicaux</div>
        `;

        sortedFavoris.forEach(favori => {
            const coteClass = `cote-${favori.cotePreference}`;

            html += `
                <div class="favoris-item">
                    <span class="favoris-genre">${favori.musicGenreDescription}</span>
                    <span class="favoris-cote ${coteClass}">${favori.cotePreference}/10</span>
                </div>
            `;
        });

        html += `</div>`;
        return html;
    }

    // Fonction pour afficher les r√©seaux sociaux
    function displayReseaux(reseauxList) {
        if (!reseauxList || reseauxList.trim() === '') {
            return `
                <div class="reseaux-section">
                    <div class="reseaux-title">FOLLOW ME</div>
                    <div class="no-content">Aucun r√©seau social ajout√©</div>
                </div>
            `;
        }

        const reseauxArray = reseauxList.split(';').filter(url => url.trim() !== '');

        if (reseauxArray.length === 0) {
            return `
                <div class="reseaux-section">
                    <div class="reseaux-title">FOLLOW ME</div>
                    <div class="no-content">Aucun r√©seau social ajout√©</div>
                </div>
            `;
        }

        let html = `
            <div class="reseaux-section">
                <div class="reseaux-title">FOLLOW ME</div>
                <div class="icons-grid">
        `;

        reseauxArray.forEach((url) => {
            const cleanedUrl = cleanUrl(url);
            const reseauInfo = getReseauInfo(cleanedUrl);

            if (reseauInfo.type === 'logo') {
                // R√©seaux avec logos pleins
                html += createLogoReseauIcon(cleanedUrl, reseauInfo.network, reseauInfo.logo);
            } else {
                // Nouveaux r√©seaux avec effet verre
                html += createCustomReseauIcon(cleanedUrl, reseauInfo.network);
            }
        });

        // Si le nombre de r√©seaux est impair, ajouter un √©l√©ment vide pour garder l'alignement
        if (reseauxArray.length % 2 !== 0) {
            html += `<div style="max-width: 140px; aspect-ratio: 1 / 1;"></div>`;
        }

        html += `
                </div>
            </div>
        `;
        return html;
    }

    async function loadUserProfile() {
        targetUserId = getUserIdFromURL();

        if (!targetUserId) {
            document.getElementById('profileContent').innerHTML = `
                <div class="error">ID utilisateur manquant dans l'URL</div>
            `;
            return;
        }

        try {
            // R√©cup√©rer l'utilisateur courant
            currentUserData = await getCurrentUser();
            if (!currentUserData) {
                throw new Error('Impossible de r√©cup√©rer votre profil');
            }

            currentUserId = currentUserData.id;

            // Charger les donn√©es du profil cible
            const response = await fetch(`/api/users/${targetUserId}`, {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + token,
                    'Content-Type': 'application/json'
                }
            });

            if (!response.ok) {
                if (response.status === 404) {
                    throw new Error('Utilisateur non trouv√©');
                }
                throw new Error('Erreur lors du chargement du profil');
            }

            const user = await response.json();

            // Mettre √† jour l'interface
            document.getElementById('profileUsername').textContent = user.username;
            document.getElementById('profilePhoto').src = user.photoUrl || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.username)}&size=120&background=667eea&color=fff`;

            // Gestion de l'erreur de chargement de l'image
            document.getElementById('profilePhoto').onerror = function() {
                this.src = `https://ui-avatars.com/api/?name=${encodeURIComponent(user.username)}&size=120&background=667eea&color=fff`;
            };

            // JOUER LE SON D'ENTR√âE IMM√âDIATEMENT
            if (user.sonEntreeURL) {
                playSonEntree(user.sonEntreeURL);
            }

            // V√©rifier si c'est le profil de l'utilisateur courant
            const isCurrentUser = (currentUserId.toString() === targetUserId.toString());

            // Charger et afficher les favoris musicaux
            const favoris = await loadMusicFavoris(targetUserId);
            const favorisSection = displayMusicFavoris(favoris);

            // Afficher les r√©seaux sociaux
            const reseauxSection = displayReseaux(user.listeReseaux);

            // Afficher les informations du profil
            document.getElementById('profileContent').innerHTML = `
                <div class="info-group">
                    <div class="info-label">Nom d'utilisateur</div>
                    <div class="info-value">${user.username}</div>
                </div>
                <div class="info-group">
                    <div class="info-label">Email</div>
                    <div class="info-value">${user.email}</div>
                </div>
                <div class="info-group">
                    <div class="info-label">R√¥le</div>
                    <div class="info-value">${user.role}</div>
                </div>
                <div class="info-group">
                    <div class="info-label">Membre depuis</div>
                    <div class="info-value">${new Date(user.createdAt).toLocaleDateString('fr-FR')}</div>
                </div>

                ${favorisSection}
                ${reseauxSection}

                <!-- Boutons d'action -->
                <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 20px;">
                    <!-- Bouton Discuter - affich√© seulement si ce n'est PAS l'utilisateur courant -->
                    ${!isCurrentUser ? `
                        <button class="chat-button" onclick="startConversation('${user.id}', '${user.username}')">
                            üí¨ Discuter avec ${user.username}
                        </button>
                    ` : ''}

                    <!-- Bouton Modifier mon profil - affich√© seulement si c'est l'utilisateur courant -->
                    ${isCurrentUser ? `
                        <button class="edit-profile-button" onclick="editProfile()">
                            ‚úèÔ∏è Modifier mon profil
                        </button>
                    ` : ''}
                </div>
            `;

        } catch(error) {
            console.error('Erreur:', error);
            document.getElementById('profileContent').innerHTML = `
                <div class="error">
                    ${error.message}
                    <br><br>
                    <button onclick="loadUserProfile()" style="margin-top:10px; padding:8px 16px; background:#667eea; color:white; border:none; border-radius:8px; cursor:pointer;">
                        R√©essayer
                    </button>
                </div>
            `;
        }
    }

    // Fonction pour d√©marrer une conversation
    function startConversation(userId, username) {
        window.location.href = `/menu/ma_communaute/conversation.html?userId=${userId}`;
    }

    // Fonction pour modifier le profil
    function editProfile() {
        window.location.href = '/menu/modifier_profil.html';
    }

    // D√©connexion
    document.getElementById('btnLogout').addEventListener('click', async () => {
        const refreshToken = localStorage.getItem('refreshToken');

        try {
            if (refreshToken) {
                await fetch('/api/auth/logout', {
                    method: 'POST',
                    headers: { 'Content-Type':'application/json' },
                    body: JSON.stringify({ refreshToken })
                });
            }

            localStorage.removeItem('accessToken');
            localStorage.removeItem('refreshToken');
            alert('D√©connexion r√©ussie');
            window.location.href = '/connection/connection.html';

        } catch(err) {
            console.error('Erreur d√©connexion:', err);
            localStorage.removeItem('accessToken');
            localStorage.removeItem('refreshToken');
            window.location.href = '/connection/connection.html';
        }
    });

    // Charger le profil au d√©marrage
    document.addEventListener('DOMContentLoaded', loadUserProfile);
</script>

</body>
</html>